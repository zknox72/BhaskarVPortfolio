---
import { getCollection } from 'astro:content';
import ContactCTA from '../components/ContactCTA.astro';
import Hero from '../components/Hero.astro';
import BaseLayout from '../layouts/BaseLayout.astro';

const publications = await getCollection('publications');
const pubData = publications[0].data;

const journalPubs = pubData.journal || [];
const conferencePubs = pubData.conference || [];
const prepPubs = pubData.preparation || [];
---

<BaseLayout title="Publications | Bhaskar Vajipeyajula" description="Publications and research output">
	<div class="stack gap-20">
		<main class="wrapper about">
			<Hero
				title="Publications"
				tagline="Peer-reviewed journal articles and conference presentations from my research."
			/>

			<section class="pub-section">
				<div class="tabs-container">
					<div class="tabs-nav">
						<button class="tab-btn active" data-tab="journal">
							<span class="tab-label">Journal Publications</span>
							<span class="tab-count">{journalPubs.length}</span>
						</button>
						<button class="tab-btn" data-tab="conference">
							<span class="tab-label">Conference</span>
							<span class="tab-count">{conferencePubs.length}</span>
						</button>
						<button class="tab-btn" data-tab="preparation">
							<span class="tab-label">In Preparation</span>
							<span class="tab-count">{prepPubs.length}</span>
						</button>
					</div>

					<!-- Journal Publications Tab -->
					<div class="tab-content active" id="journal">
						<div class="pub-cards-grid">
							{journalPubs.map((pub) => (
								<div class="pub-card">
									<div class="pub-meta">
										<span class="pub-year">{pub.year}</span>
										<span class="pub-type">Journal</span>
									</div>
									<h3 class="pub-title">{pub.title}</h3>
									<p class="pub-authors">{pub.authors}</p>
									<p class="pub-journal">{pub.journal}</p>
									<a href={`mailto:vaji19@tamu.edu?subject=Requesting ${pub.title}&body=Hey! I like your work and would love to read this. Thank you`} class="request-btn">Request</a>
								</div>
							))}
						</div>
					</div>

					<!-- Conference Publications Tab -->
					<div class="tab-content" id="conference">
						<div class="pub-cards-grid">
							{conferencePubs.map((pub) => (
								<div class="pub-card">
									<div class="pub-meta">
										<span class="pub-year">{pub.year}</span>
										<span class="pub-type">Conference</span>
									</div>
									<h3 class="pub-title">{pub.title}</h3>
									<p class="pub-authors">{pub.authors}</p>
									<p class="pub-journal">{pub.journal}</p>
									<a href={`mailto:vaji19@tamu.edu?subject=Requesting ${pub.title}&body=Hey! I like your work and would love to read this. Thank you`} class="request-btn">Request</a>
								</div>
							))}
						</div>
					</div>

					<!-- Papers in Preparation Tab -->
					<div class="tab-content" id="preparation">
						<div class="prep-cards-grid">
							{prepPubs.map((pub) => (
								<div class="pub-card prep">
									<h3 class="pub-title">{pub.title}</h3>
								</div>
							))}
						</div>
					</div>
				</div>
			</section>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.about {
		display: flex;
		flex-direction: column;
		gap: 3.5rem;
	}

	section {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		color: var(--gray-200);
	}

	.pub-section {
		width: 100%;
	}

	/* Tabs Navigation */
	.tabs-container {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.tabs-nav {
		display: flex;
		gap: 0.75rem;
		flex-wrap: wrap;
		background: rgba(var(--gray-800), 0.6);
		border-radius: 1.25rem;
		padding: 0.75rem;
		border: 2px solid rgba(var(--gray-700), 0.8);
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		backdrop-filter: blur(10px);
	}

	.tab-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 0.7rem;
		padding: 1rem 1.6rem;
		border: 2px solid transparent;
		background: transparent;
		color: var(--gray-400);
		font-size: 1rem;
		font-weight: 700;
		cursor: pointer;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		position: relative;
		border-radius: 0.875rem;
		white-space: nowrap;
		flex-shrink: 0;
		letter-spacing: 0.3px;
	}

	.tab-btn:hover {
		color: var(--gray-100);
		background: rgba(var(--accent-color), 0.15);
		border-color: rgba(var(--accent-color), 0.4);
	}

	.tab-btn.active {
		color: var(--gray-0);
		background: linear-gradient(135deg, var(--accent-light), var(--accent-regular));
		border-color: var(--accent-light);
		box-shadow: 0 6px 20px rgba(var(--accent-color), 0.4);
		font-weight: 800;
	}

	.tab-label {
		display: inline;
	}

	@media (max-width: 640px) {
		.tabs-nav {
			gap: 0.5rem;
			padding: 0.8rem;
			border-radius: 0.8rem;
		}

		.tab-btn {
			padding: 0.9rem 1.2rem;
			font-size: 0.9rem;
			font-weight: 700;
		}
	}

	@media (min-width: 641px) and (max-width: 1023px) {
		.tab-btn {
			padding: 1rem 1.6rem;
			font-size: 1rem;
		}
	}

	@media (min-width: 1024px) {
		.tabs-nav {
			gap: 1rem;
			padding: 1.2rem;
		}

		.tab-btn {
			padding: 1.2rem 2rem;
			font-size: 1.1rem;
		}
	}

	.tab-count {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		min-width: 2rem;
		height: 2rem;
		padding: 0 0.6rem;
		background: rgba(var(--accent-color), 0.25);
		color: var(--accent-regular);
		border-radius: 0.625rem;
		font-size: 0.85rem;
		font-weight: 800;
		border: 1.5px solid rgba(var(--accent-color), 0.35);
	}

	.tab-btn:hover .tab-count {
		background: rgba(var(--accent-color), 0.35);
		border-color: rgba(var(--accent-color), 0.5);
	}

	.tab-btn.active .tab-count {
		background: rgba(255, 255, 255, 0.35);
		color: var(--accent-bg);
		border-color: rgba(255, 255, 255, 0.5);
		font-weight: 900;
	}

	/* Tab Content */
	.tab-content {
		display: none;
		opacity: 0;
		animation: slideInFade 0.35s cubic-bezier(0.4, 0, 0.2, 1) forwards;
	}

	.tab-content.active {
		display: block;
		opacity: 1;
	}

	@keyframes slideInFade {
		from {
			opacity: 0;
			transform: translateY(8px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.pub-cards-grid,
	.prep-cards-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 1.5rem;
		width: 100%;
	}

	@media (min-width: 640px) {
		.pub-cards-grid,
		.prep-cards-grid {
			grid-template-columns: repeat(2, 1fr);
			gap: 2rem;
		}
	}

	@media (min-width: 1024px) {
		.pub-cards-grid,
		.prep-cards-grid {
			grid-template-columns: repeat(4, 1fr);
		}
	}

	.pub-card {
		display: flex;
		flex-direction: column;
		padding: 2rem;
		border: 1px solid var(--gray-800);
		border-radius: 1.5rem;
		background: var(--gradient-subtle);
		box-shadow: var(--shadow-sm);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		overflow: hidden;
		position: relative;
		gap: 0.5rem;
	}

	.pub-card::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 0;
		background: linear-gradient(90deg, var(--accent-regular), rgba(var(--accent-color), 0.3), transparent);
		transition: height 0.3s ease;
	}

	.pub-card:hover {
		border-color: var(--gray-700);
		box-shadow: var(--shadow-md);
		background: var(--gradient-subtle-2);
		transform: translateY(-2px);
	}

	.pub-card:hover::before {
		height: 3px;
	}

	.pub-meta {
		display: flex;
		gap: 0.75rem;
		align-items: center;
		flex-wrap: wrap;
		position: relative;
		z-index: 1;
		margin-bottom: 0.5rem;
	}

	.pub-year {
		background: rgba(var(--accent-color), 0.2);
		color: var(--accent-regular);
		padding: 0.4rem 0.8rem;
		border-radius: 0.5rem;
		font-size: 0.75rem;
		font-weight: 700;
		white-space: nowrap;
		border: 1px solid rgba(var(--accent-color), 0.3);
	}

	.pub-type {
		background: rgba(var(--accent-color), 0.2);
		color: var(--accent-regular);
		padding: 0.4rem 0.8rem;
		border-radius: 0.5rem;
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		white-space: nowrap;
		border: 1px solid rgba(var(--accent-color), 0.3);
	}

	.pub-card.prep .pub-type {
		display: none;
	}

	.pub-title {
		font-size: var(--text-md);
		font-weight: 700;
		color: var(--gray-100);
		line-height: 1.6;
		margin: 0 0 0.75rem 0;
		word-wrap: break-word;
		overflow-wrap: break-word;
		position: relative;
		z-index: 1;
	}

	.pub-authors {
		font-size: var(--text-sm);
		color: var(--gray-300);
		margin: 0 0 0.5rem 0;
		line-height: 1.5;
		word-wrap: break-word;
		overflow-wrap: break-word;
		position: relative;
		z-index: 1;
	}

	.pub-journal {
		font-size: var(--text-sm);
		color: var(--gray-400);
		font-style: italic;
		margin: 0;
		word-wrap: break-word;
		overflow-wrap: break-word;
		position: relative;
		z-index: 1;
	}

	.pub-card.prep {
		border-color: rgba(255, 193, 7, 0.3);
		background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 193, 7, 0.01) 100%);
	}

	.pub-card.prep:hover {
		border-color: rgba(255, 193, 7, 0.5);
		background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 193, 7, 0.02) 100%);
		transform: translateY(-2px);
	}

	.request-btn {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		padding: 0.7rem 1.2rem;
		margin-top: 0.75rem;
		background: linear-gradient(135deg, var(--accent-regular), rgba(var(--accent-color), 0.85));
		color: var(--accent-bg);
		border: 2px solid var(--accent-regular);
		border-radius: 0.625rem;
		font-size: 0.9rem;
		font-weight: 600;
		text-decoration: none;
		cursor: pointer;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		position: relative;
		z-index: 1;
		box-shadow: 0 4px 12px rgba(var(--accent-color), 0.25);
		overflow: hidden;
	}

	.request-btn::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: rgba(255, 255, 255, 0.15);
		transition: left 0.3s ease;
		z-index: -1;
	}

	.request-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 6px 16px rgba(var(--accent-color), 0.35);
		border-color: rgba(255, 255, 255, 0.5);
	}

	.request-btn:hover::before {
		left: 0;
	}

	.request-btn:active {
		transform: translateY(0);
		box-shadow: 0 2px 8px rgba(var(--accent-color), 0.2);
	}

	:global(.content a) {
		text-decoration: 1px solid underline transparent;
		text-underline-offset: 0.25em;
		transition: text-decoration-color var(--theme-transition);
	}

	:global(.content a:hover),
	:global(.content a:focus) {
		text-decoration-color: currentColor;
	}

	@media (min-width: 50em) {
		.about {
			display: grid;
			grid-template-columns: 1fr 90% 1fr;
		}

		.about > :global(:first-child) {
			grid-column-start: 2;
		}

		section {
			display: contents;
		}

		.pub-section {
			display: flex;
			flex-direction: column;
			gap: 1.5rem;
			grid-column: 2 / 4;
			width: auto;
		}

		.pub-cards-grid,
		.prep-cards-grid {
			grid-template-columns: repeat(4, 1fr);
			gap: 1.5rem;
		}
	}
</style>

<script>
	// Tab switching functionality
	function initTabs() {
		const tabBtns = document.querySelectorAll('.tab-btn');
		const tabContents = document.querySelectorAll('.tab-content');

		if (tabBtns.length === 0 || tabContents.length === 0) return;

		tabBtns.forEach(btn => {
			btn.addEventListener('click', (e) => {
				e.preventDefault();
				
				// Remove active class from all buttons and contents
				tabBtns.forEach(b => b.classList.remove('active'));
				tabContents.forEach(content => content.classList.remove('active'));

				// Add active class to clicked button
				btn.classList.add('active');
				
				// Show corresponding content
				const tabId = btn.getAttribute('data-tab');
				const tabContent = document.getElementById(tabId);
				if (tabContent) {
					tabContent.classList.add('active');
				}
			});

			// Keyboard navigation
			btn.addEventListener('keydown', (e) => {
				let targetBtn = null;
				if (e.key === 'ArrowLeft') {
					targetBtn = btn.previousElementSibling || tabBtns[tabBtns.length - 1];
				} else if (e.key === 'ArrowRight') {
					targetBtn = btn.nextElementSibling || tabBtns[0];
				}
				
				if (targetBtn && targetBtn.classList.contains('tab-btn')) {
					e.preventDefault();
					targetBtn.click();
					targetBtn.focus();
				}
			});
		});

		// Set first tab as active on load
		if (tabBtns.length > 0) {
			const firstBtn = tabBtns[0];
			if (!firstBtn.classList.contains('active')) {
				firstBtn.click();
			}
		}
	}

	// Initialize tabs when DOM is ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initTabs);
	} else {
		initTabs();
	}
</script>

<style>
.request-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.7rem 1.2rem;
    margin-top: 0.75rem;
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: white;
    border: 3px solid #1e40af;
    border-radius: 0.625rem;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 1;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
    overflow: hidden;
}

.request-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.15);
    transition: left 0.3s ease;
    z-index: -1;
}

.request-btn:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, #1d4ed8, #1e40af);
    box-shadow: 0 8px 20px rgba(37, 99, 235, 0.5);
    border-color: #0f2a7f;
}

.request-btn:hover::before {
    left: 0;
}

.request-btn:active {
    transform: translateY(0);
    background: linear-gradient(135deg, #1e40af, #1d4ed8);
    box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
}
</style>
